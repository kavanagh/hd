(function(e){function t(r){function o(e){return e&&"object"==typeof e&&!_r(e)&&nr.call(e,"__wrapped__")?e:new X(e)}function I(e){var t=e.length,n=t>=c;if(n)for(var r={},i=-1;t>++i;){var o=u+e[i];(r[o]||(r[o]=[])).push(e[i])}return function(t){if(n){var i=u+t;return r[i]&&Jt(r[i],t)>-1}return Jt(e,t)>-1}}function $(e){return e.charCodeAt(0)}function F(e,t){var r=e.index,i=t.index;if(e=e.criteria,t=t.criteria,e!==t){if(e>t||e===n)return 1;if(t>e||t===n)return-1}return i>r?-1:1}function M(e,t,n,r){function i(){var r=arguments,c=s?this:t;if(o||(e=t[a]),n.length&&(r=r.length?(r=mr.call(r),u?r.concat(n):n.concat(r)):n),this instanceof i){V.prototype=e.prototype,c=new V,V.prototype=null;var l=e.apply(c,r);return ft(l)?l:c}return e.apply(c,r)}var o=lt(e),s=!n,a=t;if(s){var u=r;n=t}else if(!o){if(!r)throw new Xn;t=e}return i}function B(){for(var e,t={shadowedProps:T,support:xr,arrays:"isArray(iterable)",bottom:"",init:"iterable",loop:"",top:"",useHas:!0,useKeys:!!Er},n=0;e=arguments[n];n++)for(var r in e)t[r]=e[r];var i=t.args;t.firstArg=/^[^,]+/.exec(i)[0];var s=Fn("hasOwnProperty, isArguments, isArray, isString, keys, lodash, objectTypes","return function("+i+") {\n"+wr(t)+"\n}");return s(nr,G,_r,mt,Er,o,L)}function W(e){return"\\"+q[e]}function U(e){return Sr[e]}function z(e){return"function"!=typeof e.toString&&"string"==typeof(e+"")}function X(e){this.__wrapped__=e}function V(){}function J(e){var t=!1;if(!e||sr.call(e)!=D||!xr.argsClass&&G(e))return t;var n=e.constructor;return(lt(n)?n instanceof n:xr.nodeClass||!z(e))?xr.ownLast?(Hr(e,function(e,n,r){return t=nr.call(r,n),!1}),t===!0):(Hr(e,function(e,n){t=n}),t===!1||nr.call(e,t)):t}function Y(e,t,r){t||(t=0),r===n&&(r=e?e.length:0);for(var i=-1,o=r-t||0,s=Rn(0>o?0:o);o>++i;)s[i]=e[t+i];return s}function Q(e){return Ar[e]}function G(e){return sr.call(e)==_}function K(e,t,r,i,s,a){var u=e;if("function"==typeof t&&(i=r,r=t,t=!1),"function"==typeof r){if(r=i===n?r:o.createCallback(r,i,1),u=r(u),u!==n)return u;u=e}var c=ft(u);if(c){var l=sr.call(u);if(!P[l]||!xr.nodeClass&&z(u))return u;var f=_r(u)}if(!c||!t)return c?f?Y(u):Dr({},u):u;var p=br[l];switch(l){case E:case j:return new p(+u);case A:case H:return new p(u);case O:return p(u.source,g.exec(u))}s||(s=[]),a||(a=[]);for(var h=s.length;h--;)if(s[h]==e)return a[h];return u=f?p(u.length):{},f&&(nr.call(e,"index")&&(u.index=e.index),nr.call(e,"input")&&(u.input=e.input)),s.push(e),a.push(u),(f?St:Pr)(e,function(e,i){u[i]=K(e,t,r,n,s,a)}),u}function Z(e,t,n){return K(e,!0,t,n)}function et(e,t,r){var i;return t=o.createCallback(t,r),Pr(e,function(e,r,o){return t(e,r,o)?(i=r,!1):n}),i}function tt(e){var t=[];return Hr(e,function(e,n){lt(e)&&t.push(n)}),t.sort()}function nt(e,t){return e?nr.call(e,t):!1}function rt(e){for(var t=-1,n=Er(e),r=n.length,i={};r>++t;){var o=n[t];i[e[o]]=o}return i}function it(e){return e===!0||e===!1||sr.call(e)==E}function ot(e){return e?"object"==typeof e&&sr.call(e)==j:!1}function st(e){return e?1===e.nodeType:!1}function at(e){var t=!0;if(!e)return t;var n=sr.call(e),r=e.length;return n==N||n==H||(xr.argsClass?n==_:G(e))||n==D&&"number"==typeof r&&lt(e.splice)?!r:(Pr(e,function(){return t=!1}),t)}function ut(e,t,r,i,s,u){var c=r===a;if("function"==typeof r&&!c){r=o.createCallback(r,i,2);var l=r(e,t);if(l!==n)return!!l}if(e===t)return 0!==e||1/e==1/t;var f=typeof e,p=typeof t;if(e===e&&(!e||"function"!=f&&"object"!=f)&&(!t||"function"!=p&&"object"!=p))return!1;if(null==e||null==t)return e===t;var h=sr.call(e),d=sr.call(t);if(h==_&&(h=D),d==_&&(d=D),h!=d)return!1;switch(h){case E:case j:return+e==+t;case A:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case O:case H:return e==zn(t)}var g=h==N;if(!g){if(nr.call(e,"__wrapped__ ")||nr.call(t,"__wrapped__"))return ut(e.__wrapped__||e,t.__wrapped__||t,r,i,s,u);if(h!=D||!xr.nodeClass&&(z(e)||z(t)))return!1;var m=!xr.argsObject&&G(e)?Wn:e.constructor,v=!xr.argsObject&&G(t)?Wn:t.constructor;if(m!=v&&!(lt(m)&&m instanceof m&&lt(v)&&v instanceof v))return!1}s||(s=[]),u||(u=[]);for(var y=s.length;y--;)if(s[y]==e)return u[y]==t;var b=0;if(l=!0,s.push(e),u.push(t),g){if(y=e.length,b=t.length,l=b==e.length,!l&&!c)return l;for(;b--;){var x=y,w=t[b];if(c)for(;x--&&!(l=ut(e[x],w,r,i,s,u)););else if(!(l=ut(e[b],w,r,i,s,u)))break}return l}return Hr(t,function(t,o,a){return nr.call(a,o)?(b++,l=nr.call(e,o)&&ut(e[o],t,r,i,s,u)):n}),l&&!c&&Hr(e,function(e,t,r){return nr.call(r,t)?l=--b>-1:n}),l}function ct(e){return cr(e)&&!lr(parseFloat(e))}function lt(e){return"function"==typeof e}function ft(e){return e?L[typeof e]:!1}function pt(e){return dt(e)&&e!=+e}function ht(e){return null===e}function dt(e){return"number"==typeof e||sr.call(e)==A}function gt(e){return e?L[typeof e]&&sr.call(e)==O:!1}function mt(e){return"string"==typeof e||sr.call(e)==H}function vt(e){return e===n}function yt(e,t,r){var i=arguments,s=0,u=2;if(!ft(e))return e;if(r===a)var c=i[3],l=i[4],f=i[5];else l=[],f=[],"number"!=typeof r&&(u=i.length),u>3&&"function"==typeof i[u-2]?c=o.createCallback(i[--u-1],i[u--],2):u>2&&"function"==typeof i[u-1]&&(c=i[--u]);for(;u>++s;)(_r(i[s])?St:Pr)(i[s],function(t,r){var i,o,s=t,u=e[r];if(t&&((o=_r(t))||Lr(t))){for(var p=l.length;p--;)if(i=l[p]==t){u=f[p];break}if(!i){var h;c&&(s=c(u,t),(h=s!==n)&&(u=s)),h||(u=o?_r(u)?u:[]:Lr(u)?u:{}),l.push(t),f.push(u),h||(u=yt(u,t,a,c,l,f))}}else c&&(s=c(u,t),s===n&&(s=t)),s!==n&&(u=s);e[r]=u});return e}function bt(e,t,n){var r="function"==typeof t,i={};if(r)t=o.createCallback(t,n);else var s=Zn.apply(Vn,mr.call(arguments,1));return Hr(e,function(e,n,o){(r?!t(e,n,o):0>Jt(s,n))&&(i[n]=e)}),i}function xt(e){for(var t=-1,n=Er(e),r=n.length,i=Rn(r);r>++t;){var o=n[t];i[t]=[o,e[o]]}return i}function wt(e,t,n){var r={};if("function"!=typeof t)for(var i=-1,s=Zn.apply(Vn,mr.call(arguments,1)),a=ft(e)?s.length:0;a>++i;){var u=s[i];u in e&&(r[u]=e[u])}else t=o.createCallback(t,n),Hr(e,function(e,n,i){t(e,n,i)&&(r[n]=e)});return r}function kt(e){for(var t=-1,n=Er(e),r=n.length,i=Rn(r);r>++t;)i[t]=e[n[t]];return i}function Tt(e){var t=-1,n=Zn.apply(Vn,mr.call(arguments,1)),r=n.length,i=Rn(r);for(xr.unindexedChars&&mt(e)&&(e=e.split(""));r>++t;)i[t]=e[n[t]];return i}function Ct(e,t,r){var i=-1,o=e?e.length:0,s=!1;return r=(0>r?pr(0,o+r):r)||0,"number"==typeof o?s=(mt(e)?e.indexOf(t,r):Jt(e,t,r))>-1:jr(e,function(e){return++i>=r?!(s=e===t):n}),s}function _t(e,t,n){var r={};return t=o.createCallback(t,n),St(e,function(e,n,i){n=zn(t(e,n,i)),nr.call(r,n)?r[n]++:r[n]=1}),r}function Nt(e,t,n){var r=!0;if(t=o.createCallback(t,n),_r(e))for(var i=-1,s=e.length;s>++i&&(r=!!t(e[i],i,e)););else jr(e,function(e,n,i){return r=!!t(e,n,i)});return r}function Et(e,t,n){var r=[];if(t=o.createCallback(t,n),_r(e))for(var i=-1,s=e.length;s>++i;){var a=e[i];t(a,i,e)&&r.push(a)}else jr(e,function(e,n,i){t(e,n,i)&&r.push(e)});return r}function jt(e,t,r){if(t=o.createCallback(t,r),!_r(e)){var i;return jr(e,function(e,r,o){return t(e,r,o)?(i=e,!1):n}),i}for(var s=-1,a=e.length;a>++s;){var u=e[s];if(t(u,s,e))return u}}function St(e,t,r){if(t&&r===n&&_r(e))for(var i=-1,o=e.length;o>++i&&t(e[i],i,e)!==!1;);else jr(e,t,r);return e}function At(e,t,n){var r={};return t=o.createCallback(t,n),St(e,function(e,n,i){n=zn(t(e,n,i)),(nr.call(r,n)?r[n]:r[n]=[]).push(e)}),r}function Dt(e,t){var n=mr.call(arguments,2),r=-1,i="function"==typeof t,o=e?e.length:0,s=Rn("number"==typeof o?o:0);return St(e,function(e){s[++r]=(i?t:e[t]).apply(e,n)}),s}function Ot(e,t,n){var r=-1,i=e?e.length:0,s=Rn("number"==typeof i?i:0);if(t=o.createCallback(t,n),_r(e))for(;i>++r;)s[r]=t(e[r],r,e);else jr(e,function(e,n,i){s[++r]=t(e,n,i)});return s}function Ht(e,t,n){var r=-1/0,i=r;if(!t&&_r(e))for(var s=-1,a=e.length;a>++s;){var u=e[s];u>i&&(i=u)}else t=!t&&mt(e)?$:o.createCallback(t,n),jr(e,function(e,n,o){var s=t(e,n,o);s>r&&(r=s,i=e)});return i}function Pt(e,t,n){var r=1/0,i=r;if(!t&&_r(e))for(var s=-1,a=e.length;a>++s;){var u=e[s];i>u&&(i=u)}else t=!t&&mt(e)?$:o.createCallback(t,n),jr(e,function(e,n,o){var s=t(e,n,o);r>s&&(r=s,i=e)});return i}function Lt(e,t,n,r){var i=3>arguments.length;if(t=o.createCallback(t,r,4),_r(e)){var s=-1,a=e.length;for(i&&(n=e[++s]);a>++s;)n=t(n,e[s],s,e)}else jr(e,function(e,r,o){n=i?(i=!1,e):t(n,e,r,o)});return n}function qt(e,t,n,r){var i=e,s=e?e.length:0,a=3>arguments.length;if("number"!=typeof s){var u=Er(e);s=u.length}else xr.unindexedChars&&mt(e)&&(i=e.split(""));return t=o.createCallback(t,r,4),St(e,function(e,r,o){r=u?u[--s]:--s,n=a?(a=!1,i[r]):t(n,i[r],r,o)}),n}function Rt(e,t,n){return t=o.createCallback(t,n),Et(e,function(e,n,r){return!t(e,n,r)})}function It(e){var t=-1,n=e?e.length:0,r=Rn("number"==typeof n?n:0);return St(e,function(e){var n=er(gr()*(++t+1));r[t]=r[n],r[n]=e}),r}function $t(e){var t=e?e.length:0;return"number"==typeof t?t:Er(e).length}function Ft(e,t,n){var r;if(t=o.createCallback(t,n),_r(e))for(var i=-1,s=e.length;s>++i&&!(r=t(e[i],i,e)););else jr(e,function(e,n,i){return!(r=t(e,n,i))});return!!r}function Mt(e,t,n){var r=-1,i=e?e.length:0,s=Rn("number"==typeof i?i:0);for(t=o.createCallback(t,n),St(e,function(e,n,i){s[++r]={criteria:t(e,n,i),index:r,value:e}}),i=s.length,s.sort(F);i--;)s[i]=s[i].value;return s}function Bt(e){return e&&"number"==typeof e.length?xr.unindexedChars&&mt(e)?e.split(""):Y(e):kt(e)}function Wt(e){for(var t=-1,n=e?e.length:0,r=[];n>++t;){var i=e[t];i&&r.push(i)}return r}function Ut(e){for(var t=-1,n=e?e.length:0,r=Zn.apply(Vn,mr.call(arguments,1)),i=I(r),o=[];n>++t;){var s=e[t];i(s)||o.push(s)}return o}function zt(e,t,n){var r=-1,i=e?e.length:0;for(t=o.createCallback(t,n);i>++r;)if(t(e[r],r,e))return r;return-1}function Xt(e,t,n){if(e){var r=0,i=e.length;if("number"!=typeof t&&null!=t){var s=-1;for(t=o.createCallback(t,n);i>++s&&t(e[s],s,e);)r++}else if(r=t,null==r||n)return e[0];return Y(e,0,hr(pr(0,r),i))}}function Vt(e,t,n,r){var i=-1,s=e?e.length:0,a=[];for("boolean"!=typeof t&&null!=t&&(r=n,n=t,t=!1),null!=n&&(n=o.createCallback(n,r));s>++i;){var u=e[i];n&&(u=n(u,i,e)),_r(u)?rr.apply(a,t?u:Vt(u)):a.push(u)}return a}function Jt(e,t,n){var r=-1,i=e?e.length:0;if("number"==typeof n)r=(0>n?pr(0,i+n):n||0)-1;else if(n)return r=tn(e,t),e[r]===t?r:-1;for(;i>++r;)if(e[r]===t)return r;return-1}function Yt(e,t,n){if(!e)return[];var r=0,i=e.length;if("number"!=typeof t&&null!=t){var s=i;for(t=o.createCallback(t,n);s--&&t(e[s],s,e);)r++}else r=null==t||n?1:t||r;return Y(e,0,hr(pr(0,i-r),i))}function Qt(e){var t=arguments,n=t.length,r={0:{}},i=-1,o=e?e.length:0,s=o>=c,a=[],l=a;e:for(;o>++i;){var f=e[i];if(s)var p=u+f,h=r[0][p]?!(l=r[0][p]):l=r[0][p]=[];if(h||0>Jt(l,f)){s&&l.push(f);for(var d=n;--d;)if(!(r[d]||(r[d]=I(t[d])))(f))continue e;a.push(f)}}return a}function Gt(e,t,n){if(e){var r=0,i=e.length;if("number"!=typeof t&&null!=t){var s=i;for(t=o.createCallback(t,n);s--&&t(e[s],s,e);)r++}else if(r=t,null==r||n)return e[i-1];return Y(e,pr(0,i-r))}}function Kt(e,t,n){var r=e?e.length:0;for("number"==typeof n&&(r=(0>n?pr(0,r+n):hr(n,r-1))+1);r--;)if(e[r]===t)return r;return-1}function Zt(e,t,n){e=+e||0,n=+n||1,null==t&&(t=e,e=0);for(var r=-1,i=pr(0,Gn((t-e)/n)),o=Rn(i);i>++r;)o[r]=e,e+=n;return o}function en(e,t,n){if("number"!=typeof t&&null!=t){var r=0,i=-1,s=e?e.length:0;for(t=o.createCallback(t,n);s>++i&&t(e[i],i,e);)r++}else r=null==t||n?1:pr(0,t);return Y(e,r)}function tn(e,t,n,r){var i=0,s=e?e.length:i;for(n=n?o.createCallback(n,r,1):_n,t=n(t);s>i;){var a=i+s>>>1;t>n(e[a])?i=a+1:s=a}return i}function nn(e){return _r(e)||(arguments[0]=e?mr.call(e):Vn),rn(Zn.apply(Vn,arguments))}function rn(e,t,n,r){var i=-1,s=e?e.length:0,a=[],l=a;"boolean"!=typeof t&&null!=t&&(r=n,n=t,t=!1);var f=!t&&s>=c;if(f)var p={};for(null!=n&&(l=[],n=o.createCallback(n,r));s>++i;){var h=e[i],d=n?n(h,i,e):h;if(f)var g=u+d,m=p[g]?!(l=p[g]):l=p[g]=[];(t?!i||l[l.length-1]!==d:m||0>Jt(l,d))&&((n||f)&&l.push(d),a.push(h))}return a}function on(e){for(var t=-1,n=e?e.length:0,r=n?Ht(qr(e,"length")):0,i=Rn(r);n>++t;)for(var o=-1,s=e[t];r>++o;)(i[o]||(i[o]=Rn(n)))[t]=s[o];return i}function sn(e){return Ut(e,mr.call(arguments,1))}function an(e){for(var t=-1,n=e?Ht(qr(arguments,"length")):0,r=Rn(n);n>++t;)r[t]=qr(arguments,t);return r}function un(e,t){for(var n=-1,r=e?e.length:0,i={};r>++n;){var o=e[n];t?i[o]=t[n]:i[o[0]]=o[1]}return i}function cn(e,t){return 1>e?t():function(){return 1>--e?t.apply(this,arguments):n}}function ln(e,t){return xr.fastBind||ar&&arguments.length>2?ar.call.apply(ar,arguments):M(e,t,mr.call(arguments,2))}function fn(e){for(var t=arguments.length>1?Zn.apply(Vn,mr.call(arguments,1)):tt(e),n=-1,r=t.length;r>++n;){var i=t[n];e[i]=ln(e[i],e)}return e}function pn(e,t){return M(e,t,mr.call(arguments,2),a)}function hn(){var e=arguments;return function(){for(var t=arguments,n=e.length;n--;)t=[e[n].apply(this,t)];return t[0]}}function dn(e,t,r){if(null==e)return _n;var i=typeof e;if("function"!=i){if("object"!=i)return function(t){return t[e]};var o=Er(e);return function(t){for(var n=o.length,r=!1;n--&&(r=ut(t[o[n]],e[o[n]],a)););return r}}return t!==n?1===r?function(n){return e.call(t,n)}:2===r?function(n,r){return e.call(t,n,r)}:4===r?function(n,r,i,o){return e.call(t,n,r,i,o)}:function(n,r,i){return e.call(t,n,r,i)}:e}function gn(e,t,n){function r(){o=u=null,c&&(s=e.apply(a,i))}var i,o,s,a,u,c=!0;if(n===!0){var l=!0;c=!1}else n&&L[typeof n]&&(l=n.leading,c="trailing"in n?n.trailing:c);return function(){return i=arguments,a=this,Kn(u),!o&&l?(o=!0,s=e.apply(a,i)):u=or(r,t),s}}function mn(e){var t=mr.call(arguments,1);return or(function(){e.apply(n,t)},1)}function vn(e,t){var r=mr.call(arguments,2);return or(function(){e.apply(n,r)},t)}function yn(e,t){var n={};return function(){var r=u+(t?t.apply(this,arguments):arguments[0]);return nr.call(n,r)?n[r]:n[r]=e.apply(this,arguments)}}function bn(e){var t,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}}function xn(e){return M(e,mr.call(arguments,1))}function wn(e){return M(e,mr.call(arguments,1),null,a)}function kn(e,t,n){function r(){a=null,l&&(u=new $n,o=e.apply(s,i))}var i,o,s,a,u=0,c=!0,l=!0;return n===!1?c=!1:n&&L[typeof n]&&(c="leading"in n?n.leading:c,l="trailing"in n?n.trailing:l),function(){var n=new $n;a||c||(u=n);var l=t-(n-u);return i=arguments,s=this,0>=l?(Kn(a),a=null,u=n,o=e.apply(s,i)):a||(a=or(r,l)),o}}function Tn(e,t){return function(){var n=[e];return rr.apply(n,arguments),t.apply(this,n)}}function Cn(e){return null==e?"":zn(e).replace(x,U)}function _n(e){return e}function Nn(e){St(tt(e),function(t){var n=o[t]=e[t];o.prototype[t]=function(){var e=this.__wrapped__,t=[e];rr.apply(t,arguments);var r=n.apply(o,t);return e&&"object"==typeof e&&e==r?this:new X(r)}})}function En(){return r._=Yn,this}function jn(e,t){return null==e&&null==t&&(t=1),e=+e||0,null==t&&(t=e,e=0),e+er(gr()*((+t||0)-e+1))}function Sn(e,t){var r=e?e[t]:n;return lt(r)?e[t]():r}function An(e,t,r){var i=o.templateSettings;e||(e=""),r=wr?Or({},r,i):i;var s,a=wr&&Or({},r.imports,i.imports),u=wr?Er(a):["_"],c=wr?kt(a):[o],h=0,g=r.interpolate||b,v="__p += '",y=Un((r.escape||b).source+"|"+g.source+"|"+(g===m?d:b).source+"|"+(r.evaluate||b).source+"|$","g");e.replace(y,function(t,n,r,i,o,a){return r||(r=i),v+=e.slice(h,a).replace(w,W),n&&(v+="' +\n__e("+n+") +\n'"),o&&(s=!0,v+="';\n"+o+";\n__p += '"),r&&(v+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),h=a+t.length,t}),v+="';\n";var x=r.variable,k=x;k||(x="obj",v="with ("+x+") {\n"+v+"\n}\n"),v=(s?v.replace(l,""):v).replace(f,"$1").replace(p,"$1;"),v="function("+x+") {\n"+(k?"":x+" || ("+x+" = {});\n")+"var __t, __p = '', __e = _.escape"+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+v+"return __p\n}";var T="\n/*\n//@ sourceURL="+(r.sourceURL||"/lodash/template/source["+C++ +"]")+"\n*/";try{var _=Fn(u,"return "+v+T).apply(n,c)}catch(N){throw N.source=v,N}return t?_(t):(_.source=v,_)}function Dn(e,t,n){e=(e=+e)>-1?e:0;var r=-1,i=Rn(e);for(t=o.createCallback(t,n,1);e>++r;)i[r]=t(r);return i}function On(e){return null==e?"":zn(e).replace(h,Q)}function Hn(e){var t=++s;return zn(null==e?"":e)+t}function Pn(e,t){return t(e),e}function Ln(){return zn(this.__wrapped__)}function qn(){return this.__wrapped__}r=r?R.defaults(e.Object(),r,R.pick(e,k)):e;var Rn=r.Array,In=r.Boolean,$n=r.Date,Fn=r.Function,Mn=r.Math,Bn=r.Number,Wn=r.Object,Un=r.RegExp,zn=r.String,Xn=r.TypeError,Vn=Rn(),Jn=Wn(),Yn=r._,Qn=Un("^"+zn(Jn.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),Gn=Mn.ceil,Kn=r.clearTimeout,Zn=Vn.concat,er=Mn.floor,tr=Qn.test(tr=Wn.getPrototypeOf)&&tr,nr=Jn.hasOwnProperty,rr=Vn.push,ir=r.setImmediate,or=r.setTimeout,sr=Jn.toString,ar=Qn.test(ar=sr.bind)&&ar,ur=Qn.test(ur=Rn.isArray)&&ur,cr=r.isFinite,lr=r.isNaN,fr=Qn.test(fr=Wn.keys)&&fr,pr=Mn.max,hr=Mn.min,dr=r.parseInt,gr=Mn.random,mr=Vn.slice,vr=Qn.test(r.attachEvent),yr=ar&&!/\n|true/.test(ar+vr),br={};br[N]=Rn,br[E]=In,br[j]=$n,br[D]=Wn,br[A]=Bn,br[O]=Un,br[H]=zn;var xr=o.support={};(function(){var e=function(){this.x=1},t={0:1,length:1},n=[];e.prototype={valueOf:1,y:1};for(var r in new e)n.push(r);for(r in arguments);xr.argsObject=arguments.constructor==Wn&&!(arguments instanceof Rn),xr.argsClass=G(arguments),xr.enumPrototypes=e.propertyIsEnumerable("prototype"),xr.fastBind=ar&&!yr,xr.ownLast="x"!=n[0],xr.nonEnumArgs=0!=r,xr.nonEnumShadows=!/valueOf/.test(n),xr.spliceObjects=(Vn.splice.call(t,0,1),!t[0]),xr.unindexedChars="xx"!="x"[0]+Wn("x")[0];try{xr.nodeClass=!(sr.call(document)==D&&!({toString:0}+""))}catch(i){xr.nodeClass=!0}})(1),o.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:m,variable:"",imports:{_:o}};var wr=An("var index, iterable = <%= firstArg %>, result = <%= init %>;\nif (!iterable) return result;\n<%= top %>;\n<% if (arrays) { %>var length = iterable.length; index = -1;\nif (<%= arrays %>) {  <% if (support.unindexedChars) { %>\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  <% } %>\n  while (++index < length) {\n    <%= loop %>\n  }\n}\nelse {  <%  } else if (support.nonEnumArgs) { %>\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      <%= loop %>\n    }\n  } else {  <% } %>  <% if (support.enumPrototypes) { %>\n  var skipProto = typeof iterable == 'function';\n  <% } %>  <% if (useHas && useKeys) { %>\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] ? keys(iterable) : [],\n      length = ownProps.length;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n    <% if (support.enumPrototypes) { %>if (!(skipProto && index == 'prototype')) {\n  <% } %>    <%= loop %>\n    <% if (support.enumPrototypes) { %>}\n<% } %>  }  <% } else { %>\n  for (index in iterable) {<%    if (support.enumPrototypes || useHas) { %>\n    if (<%      if (support.enumPrototypes) { %>!(skipProto && index == 'prototype')<% }      if (support.enumPrototypes && useHas) { %> && <% }      if (useHas) { %>hasOwnProperty.call(iterable, index)<% }    %>) {    <% } %>\n    <%= loop %>;    <% if (support.enumPrototypes || useHas) { %>\n    }<% } %>\n  }    <% if (support.nonEnumShadows) { %>\n\n  var ctor = iterable.constructor;\n      <% for (var k = 0; k < 7; k++) { %>\n  index = '<%= shadowedProps[k] %>';\n  if (<%      if (shadowedProps[k] == 'constructor') {        %>!(ctor && ctor.prototype === iterable) && <%      } %>hasOwnProperty.call(iterable, index)) {\n    <%= loop %>\n  }      <% } %>    <% } %>  <% } %>  <% if (arrays || support.nonEnumArgs) { %>\n}<% } %>\n<%= bottom %>;\nreturn result"),kr={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},Tr={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",arrays:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},Cr={top:"if (!objectTypes[typeof iterable]) return result;\n"+Tr.top,arrays:!1};X.prototype=o.prototype,xr.argsClass||(G=function(e){return e?nr.call(e,"callee"):!1});var _r=ur||function(e){return e?"object"==typeof e&&sr.call(e)==N:!1},Nr=B({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)",arrays:!1}),Er=fr?function(e){return ft(e)?xr.enumPrototypes&&"function"==typeof e||xr.nonEnumArgs&&e.length&&G(e)?Nr(e):fr(e):[]}:Nr,jr=B(Tr),Sr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ar=rt(Sr),Dr=B(kr,{top:kr.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),Or=B(kr),Hr=B(Tr,Cr,{useHas:!1}),Pr=B(Tr,Cr);lt(/x/)&&(lt=function(e){return"function"==typeof e&&sr.call(e)==S});var Lr=tr?function(e){if(!e||sr.call(e)!=D||!xr.argsClass&&G(e))return!1;var t=e.valueOf,n="function"==typeof t&&(n=tr(t))&&tr(n);return n?e==n||tr(e)==n:J(e)}:J,qr=Ot,Rr=Et;yr&&i&&"function"==typeof ir&&(mn=ln(ir,r));var Ir=8==dr(v+"08")?dr:function(e,t){return dr(mt(e)?e.replace(y,""):e,t||0)};return o.after=cn,o.assign=Dr,o.at=Tt,o.bind=ln,o.bindAll=fn,o.bindKey=pn,o.compact=Wt,o.compose=hn,o.countBy=_t,o.createCallback=dn,o.debounce=gn,o.defaults=Or,o.defer=mn,o.delay=vn,o.difference=Ut,o.filter=Et,o.flatten=Vt,o.forEach=St,o.forIn=Hr,o.forOwn=Pr,o.functions=tt,o.groupBy=At,o.initial=Yt,o.intersection=Qt,o.invert=rt,o.invoke=Dt,o.keys=Er,o.map=Ot,o.max=Ht,o.memoize=yn,o.merge=yt,o.min=Pt,o.omit=bt,o.once=bn,o.pairs=xt,o.partial=xn,o.partialRight=wn,o.pick=wt,o.pluck=qr,o.range=Zt,o.reject=Rt,o.rest=en,o.shuffle=It,o.sortBy=Mt,o.tap=Pn,o.throttle=kn,o.times=Dn,o.toArray=Bt,o.union=nn,o.uniq=rn,o.unzip=on,o.values=kt,o.where=Rr,o.without=sn,o.wrap=Tn,o.zip=an,o.zipObject=un,o.collect=Ot,o.drop=en,o.each=St,o.extend=Dr,o.methods=tt,o.object=un,o.select=Et,o.tail=en,o.unique=rn,Nn(o),o.clone=K,o.cloneDeep=Z,o.contains=Ct,o.escape=Cn,o.every=Nt,o.find=jt,o.findIndex=zt,o.findKey=et,o.has=nt,o.identity=_n,o.indexOf=Jt,o.isArguments=G,o.isArray=_r,o.isBoolean=it,o.isDate=ot,o.isElement=st,o.isEmpty=at,o.isEqual=ut,o.isFinite=ct,o.isFunction=lt,o.isNaN=pt,o.isNull=ht,o.isNumber=dt,o.isObject=ft,o.isPlainObject=Lr,o.isRegExp=gt,o.isString=mt,o.isUndefined=vt,o.lastIndexOf=Kt,o.mixin=Nn,o.noConflict=En,o.parseInt=Ir,o.random=jn,o.reduce=Lt,o.reduceRight=qt,o.result=Sn,o.runInContext=t,o.size=$t,o.some=Ft,o.sortedIndex=tn,o.template=An,o.unescape=On,o.uniqueId=Hn,o.all=Nt,o.any=Ft,o.detect=jt,o.foldl=Lt,o.foldr=qt,o.include=Ct,o.inject=Lt,Pr(o,function(e,t){o.prototype[t]||(o.prototype[t]=function(){var t=[this.__wrapped__];return rr.apply(t,arguments),e.apply(o,t)})}),o.first=Xt,o.last=Gt,o.take=Xt,o.head=Xt,Pr(o,function(e,t){o.prototype[t]||(o.prototype[t]=function(t,n){var r=e(this.__wrapped__,t,n);return null==t||n&&"function"!=typeof t?r:new X(r)})}),o.VERSION="1.2.1",o.prototype.toString=Ln,o.prototype.value=qn,o.prototype.valueOf=qn,jr(["join","pop","shift"],function(e){var t=Vn[e];o.prototype[e]=function(){return t.apply(this.__wrapped__,arguments)}}),jr(["push","reverse","sort","unshift"],function(e){var t=Vn[e];o.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),jr(["concat","slice","splice"],function(e){var t=Vn[e];o.prototype[e]=function(){return new X(t.apply(this.__wrapped__,arguments))}}),xr.spliceObjects||jr(["pop","shift","splice"],function(e){var t=Vn[e],n="splice"==e;o.prototype[e]=function(){var e=this.__wrapped__,r=t.apply(e,arguments);return 0===e.length&&delete e[0],n?new X(r):r}}),o._each=jr,o._iteratorTemplate=wr,o._shimKeys=Nr,o}var n,r="object"==typeof exports&&exports,i="object"==typeof module&&module&&module.exports==r&&module,o="object"==typeof global&&global;(o.global===o||o.window===o)&&(e=o);var s=0,a={},u=+new Date+"",c=200,l=/\b__p \+= '';/g,f=/\b(__p \+=) '' \+/g,p=/(__e\(.*?\)|\b__t\)) \+\n'';/g,h=/&(?:amp|lt|gt|quot|#39);/g,d=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,g=/\w*$/,m=/<%=([\s\S]+?)%>/g,v=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",y=RegExp("^["+v+"]*0+(?=.$)"),b=/($^)/,x=/[&<>"']/g,w=/['\n\r\t\u2028\u2029\\]/g,k=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],T=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],C=0,_="[object Arguments]",N="[object Array]",E="[object Boolean]",j="[object Date]",S="[object Function]",A="[object Number]",D="[object Object]",O="[object RegExp]",H="[object String]",P={};P[S]=!1,P[_]=P[N]=P[E]=P[j]=P[A]=P[D]=P[O]=P[H]=!0;var L={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},q={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},R=t();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(e._=R,define(function(){return R})):r&&!r.nodeType?i?(i.exports=R)._=R:r._=R:e._=R})(this),function(){var e,t=this,n=t.Backbone,r=[],i=r.push,o=r.slice,s=r.splice;e="undefined"!=typeof exports?exports:t.Backbone={},e.VERSION="1.0.0";var a=t._;a||"undefined"==typeof require||(a=require("underscore")),e.$=t.jQuery||t.Zepto||t.ender||t.$,e.noConflict=function(){return t.Backbone=n,this},e.emulateHTTP=!1,e.emulateJSON=!1;var u=e.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t)return this;var r=this,i=a.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,o,s,u,c,f,p;if(!this._events||!l(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;for(s=e?[e]:a.keys(this._events),u=0,c=s.length;c>u;u++)if(e=s[u],o=this._events[e]){if(this._events[e]=r=[],t||n)for(f=0,p=o.length;p>f;f++)i=o[f],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=o.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&f(n,t),r&&f(r,arguments),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return this;var i=!t&&!n;"object"==typeof t&&(n=this),e&&((r={})[e._listenerId]=e);for(var o in r)r[o].off(t,n,this),i&&delete this._listeners[o];return this}},c=/\s+/,l=function(e,t,n,r){if(!n)return!0;if("object"==typeof n){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(c.test(n)){for(var o=n.split(c),s=0,a=o.length;a>s;s++)e[t].apply(e,[o[s]].concat(r));return!1}return!0},f=function(e,t){var n,r=-1,i=e.length,o=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;i>++r;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;i>++r;)(n=e[r]).callback.call(n.ctx,o);return;case 2:for(;i>++r;)(n=e[r]).callback.call(n.ctx,o,s);return;case 3:for(;i>++r;)(n=e[r]).callback.call(n.ctx,o,s,a);return;default:for(;i>++r;)(n=e[r]).callback.apply(n.ctx,t)}},p={listenTo:"on",listenToOnce:"once"};a.each(p,function(e,t){u[t]=function(t,n,r){var i=this._listeners||(this._listeners={}),o=t._listenerId||(t._listenerId=a.uniqueId("l"));return i[o]=t,"object"==typeof n&&(r=this),t[e](n,r,this),this}}),u.bind=u.on,u.unbind=u.off,a.extend(e,u);var h=e.Model=function(e,t){var n,r=e||{};t||(t={}),this.cid=a.uniqueId("c"),this.attributes={},a.extend(this,a.pick(t,d)),t.parse&&(r=this.parse(r,t)||{}),(n=a.result(this,"defaults"))&&(r=a.defaults({},r,n)),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)},d=["url","urlRoot","collection"];a.extend(h.prototype,u,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return a.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return a.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,n){var r,i,o,s,u,c,l,f;if(null==e)return this;if("object"==typeof e?(i=e,n=t):(i={})[e]=t,n||(n={}),!this._validate(i,n))return!1;o=n.unset,u=n.silent,s=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=a.clone(this.attributes),this.changed={}),f=this.attributes,l=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],a.isEqual(f[r],t)||s.push(r),a.isEqual(l[r],t)?delete this.changed[r]:this.changed[r]=t,o?delete f[r]:f[r]=t;if(!u){s.length&&(this._pending=!0);for(var p=0,h=s.length;h>p;p++)this.trigger("change:"+s[p],this,f[s[p]],n)}if(c)return this;if(!u)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,a.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,a.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!a.isEmpty(this.changed):a.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?a.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e)a.isEqual(r[i],t=e[i])||((n||(n={}))[i]=t);return n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return a.clone(this._previousAttributes)},fetch:function(e){e=e?a.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){return t.set(t.parse(r,e),e)?(n&&n(t,r,e),t.trigger("sync",t,r,e),void 0):!1},R(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,i,o,s=this.attributes;if(null==e||"object"==typeof e?(r=e,n=t):(r={})[e]=t,!(!r||n&&n.wait||this.set(r,n)))return!1;if(n=a.extend({validate:!0},n),!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=a.extend({},s,r)),void 0===n.parse&&(n.parse=!0);var u=this,c=n.success;return n.success=function(e){u.attributes=s;var t=u.parse(e,n);return n.wait&&(t=a.extend(r||{},t)),a.isObject(t)&&!u.set(t,n)?!1:(c&&c(u,e,n),u.trigger("sync",u,e,n),void 0)},R(this,n),i=this.isNew()?"create":n.patch?"patch":"update","patch"===i&&(n.attrs=r),o=this.sync(i,this,n),r&&n.wait&&(this.attributes=s),o},destroy:function(e){e=e?a.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)},this.isNew())return e.success(),!1;R(this,e);var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=a.result(this,"urlRoot")||a.result(this.collection,"url")||q();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return this._validate({},a.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=a.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,a.extend(t||{},{validationError:n})),!1):!0}});var g=["keys","values","pairs","invert","pick","omit"];a.each(g,function(e){h.prototype[e]=function(){var t=o.call(arguments);return t.unshift(this.attributes),a[e].apply(a,t)}});var m=e.Collection=function(e,t){t||(t={}),t.url&&(this.url=t.url),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,a.extend({silent:!0},t))
},v={add:!0,remove:!0,merge:!0},y={add:!0,merge:!1,remove:!1};a.extend(m.prototype,u,{model:h,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return e.sync.apply(this,arguments)},add:function(e,t){return this.set(e,a.defaults(t||{},y))},remove:function(e,t){e=a.isArray(e)?e.slice():[e],t||(t={});var n,r,i,o;for(n=0,r=e.length;r>n;n++)o=this.get(e[n]),o&&(delete this._byId[o.id],delete this._byId[o.cid],i=this.indexOf(o),this.models.splice(i,1),this.length--,t.silent||(t.index=i,o.trigger("remove",o,this,t)),this._removeReference(o));return this},set:function(e,t){t=a.defaults(t||{},v),t.parse&&(e=this.parse(e,t)),a.isArray(e)||(e=e?[e]:[]);var n,r,o,u,c,l=t.at,f=this.comparator&&null==l&&t.sort!==!1,p=a.isString(this.comparator)?this.comparator:null,h=[],d=[],g={};for(n=0,r=e.length;r>n;n++)(o=this._prepareModel(e[n],t))&&((u=this.get(o))?(t.remove&&(g[u.cid]=!0),t.merge&&(u.set(o.attributes,t),f&&!c&&u.hasChanged(p)&&(c=!0))):t.add&&(h.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,null!=o.id&&(this._byId[o.id]=o)));if(t.remove){for(n=0,r=this.length;r>n;++n)g[(o=this.models[n]).cid]||d.push(o);d.length&&this.remove(d,t)}if(h.length&&(f&&(c=!0),this.length+=h.length,null!=l?s.apply(this.models,[l,0].concat(h)):i.apply(this.models,h)),c&&this.sort({silent:!0}),t.silent)return this;for(n=0,r=h.length;r>n;n++)(o=h[n]).trigger("add",o,this,t);return c&&this.trigger("sort",this,t),this},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;r>n;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),this.add(e,a.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,a.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,a.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return null==e?void 0:this._byId[null!=e.id?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return a.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw Error("Cannot sort a set without a comparator");return e||(e={}),a.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(a.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=a.isFunction(t)?t:function(e){return e.get(t)};return a.sortedIndex(this.models,e,r,n)},pluck:function(e){return a.invoke(this.models,"get",e)},fetch:function(e){e=e?a.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var i=e.reset?"reset":"set";n[i](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},R(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?a.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(i){t.wait&&n.add(e,t),r&&r(e,i,t)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof h)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){("add"!==e&&"remove"!==e||n===this)&&("destroy"===e&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];a.each(b,function(e){m.prototype[e]=function(){var t=o.call(arguments);return t.unshift(this.models),a[e].apply(a,t)}});var x=["groupBy","countBy","sortBy"];a.each(x,function(e){m.prototype[e]=function(t,n){var r=a.isFunction(t)?t:function(e){return e.get(t)};return a[e](this.models,r,n)}});var w=e.View=function(e){this.cid=a.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},k=/^(\S+)\s*(.*)$/,T=["model","collection","el","id","attributes","className","tagName","events"];a.extend(w.prototype,u,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,n){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=a.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];if(a.isFunction(n)||(n=this[e[t]]),n){var r=t.match(k),i=r[1],o=r[2];n=a.bind(n,this),i+=".delegateEvents"+this.cid,""===o?this.$el.on(i,n):this.$el.on(i,o,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=a.extend({},a.result(this,"options"),e)),a.extend(this,a.pick(e,T)),this.options=e},_ensureElement:function(){if(this.el)this.setElement(a.result(this,"el"),!1);else{var t=a.extend({},a.result(this,"attributes"));this.id&&(t.id=a.result(this,"id")),this.className&&(t["class"]=a.result(this,"className"));var n=e.$("<"+a.result(this,"tagName")+">").attr(t);this.setElement(n,!1)}}}),e.sync=function(t,n,r){var i=C[t];a.defaults(r||(r={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var o={type:i,dataType:"json"};if(r.url||(o.url=a.result(n,"url")||q()),null!=r.data||!n||"create"!==t&&"update"!==t&&"patch"!==t||(o.contentType="application/json",o.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),r.emulateHTTP&&("PUT"===i||"DELETE"===i||"PATCH"===i)){o.type="POST",r.emulateJSON&&(o.data._method=i);var s=r.beforeSend;r.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",i),s?s.apply(this,arguments):void 0}}"GET"===o.type||r.emulateJSON||(o.processData=!1),"PATCH"!==o.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var u=r.xhr=e.ajax(a.extend(o,r));return n.trigger("request",n,u,r),u};var C={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var _=e.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},N=/\((.*?)\)/g,E=/(\(\?)?:\w+/g,j=/\*\w+/g,S=/[\-{}\[\]+?.,\\\^$|#\s]/g;a.extend(_.prototype,u,{initialize:function(){},route:function(t,n,r){a.isRegExp(t)||(t=this._routeToRegExp(t)),a.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var i=this;return e.history.route(t,function(o){var s=i._extractParameters(t,o);r&&r.apply(i,s),i.trigger.apply(i,["route:"+n].concat(s)),i.trigger("route",n,s),e.history.trigger("route",i,n,s)}),this},navigate:function(t,n){return e.history.navigate(t,n),this},_bindRoutes:function(){if(this.routes){this.routes=a.result(this,"routes");for(var e,t=a.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(S,"\\$&").replace(N,"(?:$1)?").replace(E,function(e,t){return t?e:"([^/]+)"}).replace(j,"(.*?)"),RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return a.map(n,function(e){return e?decodeURIComponent(e):null})}});var A=e.History=function(){this.handlers=[],a.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},D=/^[#\/]|\s+$/g,O=/^\/+|\/+$/g,H=/msie [\w.]+/,P=/\/$/;A.started=!1,a.extend(A.prototype,u,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(P,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(D,"")},start:function(t){if(A.started)throw Error("Backbone.history has already been started");A.started=!0,this.options=a.extend({},{root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),r=document.documentMode,i=H.exec(navigator.userAgent.toLowerCase())&&(!r||7>=r);this.root=("/"+this.root+"/").replace(O,"/"),i&&this._wantsHashChange&&(this.iframe=e.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(n)),this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!i?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var o=this.location,s=o.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&s&&o.hash&&(this.fragment=this.getHash().replace(D,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),A.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=a.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0});return n},navigate:function(e,t){if(!A.started)return!1;if(t&&t!==!0||(t={trigger:t}),e=this.getFragment(e||""),this.fragment!==e){this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)}},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),e.history=new A;var L=function(e,t){var n,r=this;n=e&&a.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},a.extend(n,r,t);var i=function(){this.constructor=n};return i.prototype=r.prototype,n.prototype=new i,e&&a.extend(n.prototype,e),n.__super__=r.prototype,n};h.extend=m.extend=_.extend=w.extend=A.extend=L;var q=function(){throw Error('A "url" property or function must be specified')},R=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}}}.call(this);var reactor=reactor||{};(function(){var e=reactor.UserService={},t="AYSC",n=$.cookie(t);n&&(n=n.match(/USERID=(\d+)\:/));var r=function(){return n&&n.length>=2?n[0]:null},i=function(){return testUser};e.getUserId=testUser?i:r,e.setUserId=function(e){$.cookie(t,"USERID="+e+":")}})();var reactor=reactor||{};(function(e){var e=reactor.ReactionService={},t=function(e,t){var n=reactor.hostname||"ft-reactor.herokuapp.com";return $.ajax({method:"GET",timeout:1e4,dataType:"jsonp",cache:!0,data:t||null,url:["http:/",n,e].join("/")})};e.getQuestion=function(e,n){if(reactor.hostname)return t("question",{article:e,user:n}).pipe(function(e){return e.xTicks=parseInt(e.xTicks,10),e.yTicks=parseInt(e.yTicks,10),e});var r=mockData.question;return r.userId=n,r.result=testResult,$.Deferred().resolve(r)},e.getResults=function(e){return reactor.hostname?t("results",{article:e}):(mockData.results.article=e,$.Deferred().resolve(mockData.results))},e.postVote=function(e,n,r){return reactor.hostname?t("setresult",{article:e,user:n,result:r?JSON.stringify(r):""}):$.Deferred().resolve(!0)}})();var reactor=reactor||{};reactor.Reaction=Backbone.Model.extend({defaults:{xTicks:1,yTicks:1,hasVoted:!1},initialize:function(){this.set("hasVoted",!!this.get("result")),this.set("state",!this.get("result")&&this.get("userId")?"vote":"results")},getMatix:function(){var e=this._allAnswers,t=this.get("xTicks"),n=this.get("yTicks");e=this._allAnswers=[];for(var r=0;t>r;r+=1)e.push(Array(n));return e},canVote:function(){var e=this.get("hasVoted"),t=!!this.get("userId");return!e&&t},vote:function(e,t){if(this.canVote()){var n={x:e,y:t};reactor.ReactionService.postVote(this.get("articleId"),this.get("userId"),n).done(_.bind(function(){this.set("result",n),this.set("hasVoted",!0),this.set("state","results")},this))}}}),reactor.Reaction.fetchQuestion=function(e,t){return reactor.ReactionService.getQuestion(e,t).pipe(function(e){return new reactor.Reaction(e)})};var reactor=reactor||{};(function(){var e=function(e,t){return"https://twitter.com/intent/tweet?text="+escape(e)+"&url="+escape(t||location.href)},t=function(e){return e.question};reactor.AppView=Backbone.View.extend({events:{"click .reaction":"vote"},initialize:function(){this.listenTo(this.model,"change:state",this.render)},vote:function(e){var t=$(e.currentTarget),n=t.data("reaction-x"),r=t.data("reaction-y");this.model.vote(n,r)},render:function(){console.log("RENDER");var n=this.model.getMatix(),r=this.model.toJSON(),i="",o=["reaction-widget","reaction-state-"+r.state,"reaction-user-"+(r.userId?"known":"anonymous")],s="";r.result&&(s=e(t(r)));var a=120,u=120;i+='<div class="'+o.join(" ")+'">',i+='<div class="reaction-kicker">Reader Reactions:</div>',i+='<div class="reaction-question">'+r.question+"</div>",i+='<div class="reaction-controls" style="width:'+a+"px;height:"+u+'px;">',i+='<div class="reaction-graph" style="width:'+a+"px;height:"+u+'px;">';var c=r.userId?"Click to react":"",l=a/r.yTicks,f=Math.max(30,u/r.xTicks);i+=$.map(n,function(e,t){return'<div class="reaction-axis" style="width:'+a+"px;height:"+f+'px">'+$.map(e,function(e,n){return'<div class="reaction usable" style="width:'+l+"px;height:"+f+"px;line-height:"+f+'px;" data-reaction-x="'+(t+1)+'" data-reaction-y="'+(n+1)+'" title="'+c+'"></div>'}).join("")+"</div>"}).join(""),i+="</div>",i+="</div>",i+='<div class="reaction-info">';var p=r.answersCount||0;if(i+='<p class="show-on-anonymous">Login to react!</p>',p>10&&(i+='<p class="reaction-count">See how you compare to <br/>'+p+" respondants...</p>"),i+='<a href="'+s+'" target="_blank" class="tweet-reaction">Tweet this</a>',i+="</div>",i+="</div>",this.$el.html(i),"results"===r.state){console.log("RENDER resu");var h=this.$el.find(".reaction");h.removeClass("usable"),reactor.ReactionService.getResults(r.articleId).done(function(e){r.hasVoted?r.result.x+","+r.result.y:null,_.each(e.results,function(e,t){var r=t.split(",");n[r[0]-1][r[1]-1]=e}),h.each(function(e,t){var i=$(t),o=i.data("reaction-x"),s=i.data("reaction-y"),a=!!r.result&&o===r.result.x&&s===r.result.y;val=n[o-1][s-1]||0,className="reaction-result-"+parseInt(Math.min(10,Math.ceil(val/10)),10),selectedClass=a?"selected":"",c=val.toFixed(0)+"% of readers",i.attr("title",c),i.addClass(className+" "+selectedClass),i.html(a?"&#10004;":"&nbsp;")})})}}})})();var reactor=reactor||{};(function(){"use strict";var e="#target1, #target2",t=testArticle||location.pathname,n=reactor.UserService.getUserId(),r=function(e){return $("<div />").insertAfter(e)[0]};reactor.Reaction.fetchQuestion(t,n).done(function(t){$(function(){$(e).each(function(e,n){var i=r(n);new reactor.AppView({model:t,el:i}).render()})})})})();